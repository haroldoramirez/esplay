!function(e,t){"use strict";t.module("mwl.calendar",[]),t.module("mwl.calendar").constant("moment",e.moment),t.module("mwl.calendar").service("calendarHelper",["moment","calendarConfig",function(e,a){function n(){return 1===e().startOf("week").day()}function r(e){return t.isDefined(e)?e:n()}function i(t,a,n){var r=e(t).startOf(a),i=e(t).endOf(a);return n.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,r,i)})}var l=this;this.getMonthNames=function(){for(var t=[],n=0;11>=n;n++)t.push(e(new Date(2014,n)).format(a.dateFormats.month));return t},this.getWeekDayNames=function(t,n){for(var i=[],l=r(n)?22:21,o=0;6>=o;o++)i.push(e(new Date(2014,8,l+o)).format(a.dateFormats.weekDay));return i},this.eventIsInPeriod=function(t,a,n,r){return t=e(t),a=e(a),n=e(n),r=e(r),t.isAfter(n)&&t.isBefore(r)||a.isAfter(n)&&a.isBefore(r)||t.isBefore(n)&&a.isAfter(r)||t.isSame(n)||a.isSame(r)},this.getYearView=function(t,a){for(var n=[],r=l.getMonthNames(),o=i(a,"year",t),d=0;3>d;d++){for(var s=[],c=0;4>c;c++){var u=12-r.length,f=new Date(e(a).format("YYYY"),u,1),m=e(f).add(1,"month").subtract(1,"second").toDate();s.push({label:r.shift(),monthIndex:u,isToday:e(f).startOf("month").isSame(e().startOf("month")),events:o.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,f,m)}),date:e(f).startOf("month")})}n.push(s)}return n},this.getMonthView=function(t,a,n){function o(){var e=c.day()-s;return 0>e&&(e=6),e}for(var d=i(a,"month",t),s=r(n)?1:0,c=e(a).startOf("month"),u=e(a).endOf("month").date(),f=[],m=new Array(7),v=d.map(function(e,t){return e.$id=t,e}),y=1;u>=y;y++){if(1===y)for(var h=o(c),w=c.clone();h>0;)h--,w=w.subtract(1,"day"),m[h]={label:w.date(),date:w.clone(),inMonth:!1,isPast:e().startOf("day").isAfter(w),isToday:e().startOf("day").isSame(w),isFuture:e().startOf("day").isBefore(w),events:[]};if(m[o(c)]={label:c.date(),inMonth:!0,isPast:e().startOf("day").isAfter(c),isToday:e().startOf("day").isSame(c),isFuture:e().startOf("day").isBefore(c),isWeekend:[0,6].indexOf(e(c).day())>-1,date:c.clone(),events:v.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,c.clone().startOf("day"),c.clone().endOf("day"))})},y===u){h=o(c);for(var p=c.clone();6>h;)h++,p=p.add(1,"day"),m[h]={label:p.date(),date:p.clone(),inMonth:!1,isPast:e().startOf("day").isAfter(p),isToday:e().startOf("day").isSame(p),isFuture:e().startOf("day").isBefore(p),events:[]}}(6===o(c)||y===u)&&(f.push(m),m=new Array(7)),c=c.add(1,"day")}return f},this.getWeekView=function(t,n,i){var o,d,s,c,u=r(i)?1:0,f=new Array(7),m=l.getWeekDayNames(!1,i),v=n.getDay();for(s=v;s>=0;s--)c=e(n).subtract(v-s,"days").add(u,"day").toDate(),f[s]={weekDay:m[s],day:e(c).format("D"),date:e(c).format(a.dateFormats.day),isPast:e(c).startOf("day").isBefore(e().startOf("day")),isToday:e(c).startOf("day").isSame(e().startOf("day")),isFuture:e(c).startOf("day").isAfter(e().startOf("day")),isWeekend:[0,6].indexOf(e(c).day())>-1},0===s?o=c:6===s&&(d=c);for(s=v+1;7>s;s++)c=e(n).add(s-v,"days").add(u,"day").toDate(),f[s]={weekDay:m[s],day:e(c).format("D"),date:e(c).format(a.dateFormats.day),isPast:e(c).startOf("day").isBefore(e().startOf("day")),isToday:e(c).startOf("day").isSame(e().startOf("day")),isFuture:e(c).startOf("day").isAfter(e().startOf("day")),isWeekend:[0,6].indexOf(e(c).day())>-1},0===s?o=c:6===s&&(d=c);d=e(d).endOf("day").toDate(),o=e(o).startOf("day").toDate();var y=t.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,o,d)}).map(function(t){var a,n,r=e(t.starts_at).startOf("day"),i=e(t.ends_at).startOf("day"),l=e(o).startOf("day"),s=e(d).startOf("day");return a=r.isBefore(l)||r.isSame(l)?0:r.diff(l,"days"),i.isAfter(s)&&(i=s),r.isBefore(l)&&(r=l),n=e(i).diff(r,"days")+1,t.daySpan=n,t.dayOffset=a,t});return{columns:f,events:y}},this.getDayView=function(t,a,n,r,o){var d=i(a,"day",t),s=e(a).startOf("day").add(n,"hours"),c=e(a).startOf("day").add(r,"hours"),u=(r-n+1)*o,f=o/60,m=[];return d.filter(function(t){return l.eventIsInPeriod(t.starts_at,t.ends_at,e(a).startOf("day").toDate(),e(a).endOf("day").toDate())}).map(function(t){if(t.top=e(t.starts_at).isBefore(s)?0:e(t.starts_at).startOf("minute").diff(s.startOf("minute"),"minutes")*f-2,e(t.ends_at).isAfter(c))t.height=u-t.top;else{var a=t.starts_at;e(t.starts_at).isBefore(s)&&(a=s.toDate()),t.height=e(t.ends_at).diff(a,"minutes")*f}return t.top-t.height>u&&(t.height=0),t.left=0,t}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return m.forEach(function(a,n){var r=!0;a.forEach(function(t){(l.eventIsInPeriod(e.starts_at,e.ends_at,t.starts_at,t.ends_at)||l.eventIsInPeriod(t.starts_at,t.ends_at,e.starts_at,e.ends_at))&&(r=!1)}),r&&t&&(t=!1,e.left=150*n,m[n].push(e))}),t&&(e.left=150*m.length,m.push([e])),e})},this.toggleEventBreakdown=function(e,t,a){function n(){e=e.map(function(e){return e.isOpened=!1,e.map(function(e){return e.isOpened=!1,e})})}var r=[];if(e[t][a].events.length>0){var i=e[t][a].isOpened;n(),e[t][a].isOpened=!i,e[t].isOpened=!i,r=e[t][a].events}else n();return{view:e,openEvents:r}}}]),t.module("mwl.calendar").provider("calendarConfig",function(){var e={hour:"ha",day:"D MMM",month:"MMMM",weekDay:"dddd"},a={day:"dddd D MMMM, YYYY",week:"Week {week} of {year}",month:"MMMM YYYY",year:"YYYY"},n=this;n.configureDateFormats=function(a){return t.extend(e,a),n},n.configureTitleFormats=function(e){return t.extend(a,e),n},n.$get=function(){return{dateFormats:e,titleFormats:a}}}),t.module("mwl.calendar").filter("truncateEventTitle",function(){return function(e,t,a){return e?e.length>=t&&e.length/20>a/30?e.substr(0,t)+"...":e:""}}),t.module("mwl.calendar").filter("eventCountBadgeTotal",function(){return function(e){return e.filter(function(e){return e.incrementsBadgeTotal!==!1}).length}}),t.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,a){var n=e.$watch(t.mwlCollapseFallback,function(e){e?a.addClass("ng-hide"):a.removeClass("ng-hide")}),r=e.$on("$destroy",function(){r(),n()})}]}}]),t.module("mwl.calendar").directive("mwlCalendarYear",["moment",function(e){return{templateUrl:"templates/year.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",timespanClick:"=calendarTimespanClick"},controller:["$scope","$sce","$timeout","calendarHelper","eventCountBadgeTotalFilter",function(t,a,n,r,i){function l(){t.view=r.getYearView(t.events,t.currentDay),t.autoOpen&&!o&&t.view.forEach(function(a,r){a.forEach(function(a,i){e(t.currentDay).startOf("month").isSame(a.date)&&(t.monthClicked(r,i,!0),n(function(){o=!1}))})})}var o=!1;t.$sce=a,t.eventCountBadgeTotalFilter=i,t.$watch("currentDay",l),t.$watch("events",l,!0),t.monthClicked=function(e,a,n){n||t.timespanClick({calendarDate:t.view[e][a].date.startOf("month").toDate()});var i=r.toggleEventBreakdown(t.view,e,a);t.view=i.view,t.openEvents=i.openEvents},t.drillDown=function(a){var n=e(t.currentDay).clone().month(a).toDate();t.timespanClick({calendarDate:n})!==!1&&t.calendarCtrl.changeView("month",n)}}],link:function(e,t,a,n){e.calendarCtrl=n}}}]),t.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"templates/week.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",useIsoWeek:"=calendarUseIsoWeek",timespanClick:"=calendarTimespanClick"},controller:["$scope","moment","calendarHelper",function(e,t,a){function n(){e.view=a.getWeekView(e.events,e.currentDay,e.useIsoWeek)}e.drillDown=function(a){var n=t(e.currentDay).clone().date(a).toDate();e.timespanClick({calendarDate:n})!==!1&&e.calendarCtrl.changeView("day",n)},e.$watch("currentDay",n),e.$watch("events",n,!0)}],link:function(e,t,a,n){e.calendarCtrl=n}}}),t.module("mwl.calendar").directive("mwlCalendarSlideBox",function(){return{restrict:"EA",templateUrl:"templates/calendarSlideBox.html",replace:!0,controller:["$scope","$attrs",function(e,t){var a=e.$watch(t.isOpen,function(t){e.shouldCollapse=t}),n=e.$on("$destroy",function(){n(),a()})}],require:["^?mwlCalendarMonth","^?mwlCalendarYear"],link:function(e,t,a,n){e.isMonthView=!!n[0],e.isYearView=!!n[1]}}}),t.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"templates/month.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek",timespanClick:"=calendarTimespanClick"},controller:["$scope","$sce","$timeout","moment","calendarHelper","eventCountBadgeTotalFilter",function(e,t,a,n,r,i){function l(){e.view=r.getMonthView(e.events,e.currentDay,e.useIsoWeek),e.autoOpen&&!o&&e.view.forEach(function(t,r){t.forEach(function(t,i){t.inMonth&&n(e.currentDay).startOf("day").isSame(t.date.startOf("day"))&&(e.dayClicked(r,i,!0),a(function(){o=!1}))})})}var o=!1;e.$sce=t,e.eventCountBadgeTotalFilter=i,e.$watch("currentDay",l),e.$watch("events",l,!0),e.weekDays=r.getWeekDayNames(!1,e.useIsoWeek),e.dayClicked=function(t,a,n){n||e.timespanClick({calendarDate:e.view[t][a].date.startOf("day").toDate()});var i=r.toggleEventBreakdown(e.view,t,a);e.view=i.view,e.openEvents=i.openEvents},e.drillDown=function(t){var a=n(e.currentDay).clone().date(t).toDate();e.timespanClick({calendarDate:a})!==!1&&e.calendarCtrl.changeView("day",a)},e.highlightEvent=function(t,a){e.view.forEach(function(e){e.forEach(function(e){if(delete e.highlightClass,a){var n=e.events.filter(function(e){return e.$id===t.$id}).length>0;n&&(e.highlightClass="day-highlight dh-event-"+t.type)}})})}}],link:function(e,t,a,n){e.calendarCtrl=n}}}),t.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"templates/day.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventLabel:"@calendarEventLabel",timeLabel:"@calendarTimeLabel",dayViewStart:"@calendarDayViewStart",dayViewEnd:"@calendarDayViewEnd",dayViewSplit:"@calendarDayViewSplit"},controller:["$scope","moment","calendarHelper","calendarConfig",function(e,t,a,n){function r(){e.view=a.getDayView(e.events,e.currentDay,i.hours(),l.hours(),e.dayHeight)}var i=t(e.dayViewStart||"00:00","HH:mm"),l=t(e.dayViewEnd||"23:00","HH:mm");e.dayViewSplit=parseInt(e.dayViewSplit),e.dayHeight=60/e.dayViewSplit*30,e.days=[];for(var o=t(i),d=0;d<=l.diff(i,"hours");d++)e.days.push({label:o.format(n.dateFormats.hour)}),o.add(1,"hour");e.$watch("currentDay",r),e.$watch("events",r,!0)}]}}),t.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"templates/main.html",restrict:"EA",scope:{events:"=calendarEvents",view:"=calendarView",currentDay:"=calendarCurrentDay",control:"=calendarControl",eventClick:"&calendarEventClick",eventEditClick:"&calendarEditEventClick",eventDeleteClick:"&calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek",eventLabel:"@calendarEventLabel",timeLabel:"@calendarTimeLabel",dayViewStart:"@calendarDayViewStart",dayViewEnd:"@calendarDayViewEnd",weekTitleLabel:"@calendarWeekTitleLabel",timespanClick:"&calendarTimespanClick",dayViewSplit:"@calendarDayViewSplit"},controller:["$scope","$timeout","moment","calendarConfig",function(e,a,n,r){var i=this,l=e.weekTitleLabel||r.titleFormats.week;this.titleFunctions={day:function(e){return n(e).format(r.titleFormats.day)},week:function(e){return l.replace("{week}",n(e).week()).replace("{year}",n(e).format("YYYY"))},month:function(e){return n(e).format(r.titleFormats.month)},year:function(e){return n(e).format(r.titleFormats.year)}},this.changeView=function(t,a){e.view=t,e.currentDay=a},e.control=e.control||{},e.control.prev=function(){e.currentDay=n(e.currentDay).subtract(1,e.view).toDate()},e.control.next=function(){e.currentDay=n(e.currentDay).add(1,e.view).toDate()},e.control.getTitle=function(){return i.titleFunctions[e.view]?i.titleFunctions[e.view](e.currentDay):""};var o=!0,d=e.$watch(function(){return n.locale()},function(){if(o)return void(o=!1);var n=t.copy(e.view);e.view="redraw",a(function(){e.view=n})}),s=e.$on("$destroy",function(){s(),d()})}]}})}(window,angular);
//# sourceMappingURL=angular-bootstrap-calendar.min.js.map
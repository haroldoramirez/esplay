"use strict";angular.module("mwl.calendar",[]),angular.module("mwl.calendar").constant("moment",window.moment),angular.module("mwl.calendar").service("calendarHelper",["$filter","moment",function(e,t){function a(){return 1===t().startOf("week").day()}function n(e){return angular.isDefined(e)?e:a()}function r(e,a,n){var r=t(e).startOf(a),l=t(e).endOf(a);return n.filter(function(e){return i.eventIsInPeriod(e.starts_at,e.ends_at,r,l)})}var i=this;this.getMonthNames=function(t){for(var a=t?"MMM":"MMMM",n=[],r=0;11>=r;r++)n.push(e("date")(new Date(2014,r),a));return n},this.getWeekDayNames=function(t,a){for(var r=t?"EEE":"EEEE",i=[],l=n(a)?22:21,c=0;6>=c;c++)i.push(e("date")(new Date(2014,8,l+c),r));return i},this.eventIsInPeriod=function(e,a,n,r){return e=t(e),a=t(a),n=t(n),r=t(r),e.isAfter(n)&&e.isBefore(r)||a.isAfter(n)&&a.isBefore(r)||e.isBefore(n)&&a.isAfter(r)||e.isSame(n)||a.isSame(r)},this.getYearView=function(e,a){for(var n=[],l=i.getMonthNames(),c=r(a,"year",e),d=0;3>d;d++){for(var o=[],s=0;4>s;s++){var u=12-l.length,f=new Date(t(a).format("YYYY"),u,1),v=t(f).add(1,"month").subtract(1,"second").toDate();o.push({label:l.shift(),monthIndex:u,isToday:t(f).startOf("month").isSame(t().startOf("month")),events:c.filter(function(e){return i.eventIsInPeriod(e.starts_at,e.ends_at,f,v)}),date:t(f).startOf("month")})}n.push(o)}return n},this.getMonthView=function(e,a,l){function c(){var e=s.day()-o;return 0>e&&(e=6),e}for(var d=r(a,"month",e),o=n(l)?1:0,s=t(a).startOf("month"),u=t(a).endOf("month").date(),f=[],v=new Array(7),m=d.map(function(e,t){return e.$id=t,e}),y=1;u>=y;y++){if(1===y)for(var w=c(s),h=s.clone();w>0;)w--,h=h.subtract(1,"day"),v[w]={label:h.date(),date:h.clone(),inMonth:!1,events:[]};if(v[c(s)]={label:s.date(),inMonth:!0,isToday:t().startOf("day").isSame(s),date:s.clone(),events:m.filter(function(e){return i.eventIsInPeriod(e.starts_at,e.ends_at,s.clone().startOf("day"),s.clone().endOf("day"))})},y===u){w=c(s);for(var p=s.clone();6>w;)w++,p=p.add(1,"day"),v[w]={label:p.date(),date:p.clone(),inMonth:!1,events:[]}}(6===c(s)||y===u)&&(f.push(v),v=new Array(7)),s=s.add(1,"day")}return f},this.getWeekView=function(a,l,c){var d,o,s,u,f=r(l,"week",a),v=n(c)?1:0,m=new Array(7),y=i.getWeekDayNames(!1,c),w=l.getDay();for(s=w;s>=0;s--)u=t(l).subtract(w-s,"days").add(v,"day").toDate(),m[s]={weekDay:y[s],day:e("date")(u,"d"),date:e("date")(u,"d MMM"),isToday:t(u).startOf("day").isSame(t().startOf("day"))},0===s?d=u:6===s&&(o=u);for(s=w+1;7>s;s++)u=t(l).add(s-w,"days").add(v,"day").toDate(),m[s]={weekDay:y[s],day:e("date")(u,"d"),date:e("date")(u,"d MMM"),isToday:t(u).startOf("day").isSame(t().startOf("day"))},0===s?d=u:6===s&&(o=u);o=t(o).endOf("day").toDate(),d=t(d).startOf("day").toDate();var h=f.filter(function(e){return i.eventIsInPeriod(e.starts_at,e.ends_at,d,o)}).map(function(e){var a,n,r=t(e.starts_at).startOf("day"),i=t(e.ends_at).startOf("day"),l=t(d).startOf("day"),c=t(o).startOf("day");return a=r.isBefore(l)||r.isSame(l)?0:r.diff(l,"days"),i.isAfter(c)&&(i=c),r.isBefore(l)&&(r=l),n=t(i).diff(r,"days")+1,e.daySpan=n,e.dayOffset=a,e});return{columns:m,events:h}},this.getDayView=function(e,a,n,l,c){var d=r(a,"day",e),o=t(a).startOf("day").add(n,"hours"),s=t(a).startOf("day").add(l,"hours"),u=(l-n+1)*c,f=c/60,v=[];return d.filter(function(e){return i.eventIsInPeriod(e.starts_at,e.ends_at,t(a).startOf("day").toDate(),t(a).endOf("day").toDate())}).map(function(e){if(e.top=t(e.starts_at).isBefore(o)?0:t(e.starts_at).startOf("minute").diff(o.startOf("minute"),"minutes")*f-2,t(e.ends_at).isAfter(s))e.height=u-e.top;else{var a=e.starts_at;t(e.starts_at).isBefore(o)&&(a=o.toDate()),e.height=t(e.ends_at).diff(a,"minutes")*f}return e.top-e.height>u&&(e.height=0),e.left=0,e}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return v.forEach(function(a,n){var r=!0;a.forEach(function(t){(i.eventIsInPeriod(e.starts_at,e.ends_at,t.starts_at,t.ends_at)||i.eventIsInPeriod(t.starts_at,t.ends_at,e.starts_at,e.ends_at))&&(r=!1)}),r&&t&&(t=!1,e.left=150*n,v[n].push(e))}),t&&(e.left=150*v.length,v.push([e])),e})},this.toggleEventBreakdown=function(e,t,a){function n(){e=e.map(function(e){return e.isOpened=!1,e.map(function(e){return e.isOpened=!1,e})})}var r=[];if(e[t][a].events.length>0){var i=e[t][a].isOpened;n(),e[t][a].isOpened=!i,e[t].isOpened=!i,r=e[t][a].events}else n();return{view:e,openEvents:r}}}]),angular.module("mwl.calendar").filter("truncateEventTitle",function(){return function(e,t,a){return e?e.length>=t&&e.length/20>a/30?e.substr(0,t)+"...":e:""}}),angular.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,a){var n=e.$watch(t.mwlCollapseFallback,function(e){e?a.addClass("ng-hide"):a.removeClass("ng-hide")}),r=e.$on("$destroy",function(){r(),n()})}]}}]),angular.module("mwl.calendar").directive("mwlCalendarYear",["moment",function(e){return{templateUrl:"templates/year.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",timespanClick:"=calendarTimespanClick"},controller:["$scope","$sce","$timeout","calendarHelper",function(t,a,n,r){function i(){t.view=r.getYearView(t.events,t.currentDay),t.autoOpen&&!l&&t.view.forEach(function(a,r){a.forEach(function(a,i){a.label===e(t.currentDay).format("MMMM")&&(t.monthClicked(r,i,!0),n(function(){l=!1}))})})}var l=!1;t.$sce=a,t.$watch("currentDay",i),t.$watch("events",i,!0),t.monthClicked=function(e,a,n){n||t.timespanClick({$date:t.view[e][a].date.startOf("month").toDate()});var i=r.toggleEventBreakdown(t.view,e,a);t.view=i.view,t.openEvents=i.openEvents},t.drillDown=function(a){t.calendarCtrl.changeView("month",e(t.currentDay).clone().month(a).toDate())}}],link:function(e,t,a,n){e.calendarCtrl=n}}}]),angular.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"templates/week.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",useIsoWeek:"=calendarUseIsoWeek"},controller:["$scope","moment","calendarHelper",function(e,t,a){function n(){e.view=a.getWeekView(e.events,e.currentDay,e.useIsoWeek)}e.drillDown=function(a){e.calendarCtrl.changeView("day",t(e.currentDay).clone().date(a).toDate())},e.$watch("currentDay",n),e.$watch("events",n,!0)}],link:function(e,t,a,n){e.calendarCtrl=n}}}),angular.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"templates/month.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek",timespanClick:"=calendarTimespanClick"},controller:["$scope","$sce","$timeout","moment","calendarHelper",function(e,t,a,n,r){function i(){e.view=r.getMonthView(e.events,e.currentDay,e.useIsoWeek),e.autoOpen&&!l&&e.view.forEach(function(t,r){t.forEach(function(t,i){t.inMonth&&n(e.currentDay).startOf("day").isSame(t.date.startOf("day"))&&(e.dayClicked(r,i,!0),a(function(){l=!1}))})})}var l=!1;e.$sce=t,e.$watch("currentDay",i),e.$watch("events",i,!0),e.weekDays=r.getWeekDayNames(!1,e.useIsoWeek),e.dayClicked=function(t,a,n){n||e.timespanClick({$date:e.view[t][a].date.startOf("day").toDate()});var i=r.toggleEventBreakdown(e.view,t,a);e.view=i.view,e.openEvents=i.openEvents},e.drillDown=function(t){e.calendarCtrl.changeView("day",n(e.currentDay).clone().date(t).toDate())},e.highlightEvent=function(t,a){e.view=e.view.map(function(e){return e.isOpened=!1,e.map(function(e){if(delete e.highlightClass,e.isOpened=!1,a){var n=e.events.filter(function(e){return e.$id===t.$id}).length>0;n&&(e.highlightClass="day-highlight dh-event-"+t.type)}return e})})}}],link:function(e,t,a,n){e.calendarCtrl=n}}}),angular.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"templates/day.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventLabel:"@calendarEventLabel",timeLabel:"@calendarTimeLabel",dayViewStart:"@calendarDayViewStart",dayViewEnd:"@calendarDayViewEnd",dayViewSplit:"@calendarDayViewSplit"},controller:["$scope","moment","calendarHelper",function(e,t,a){function n(){e.view=a.getDayView(e.events,e.currentDay,r.hours(),i.hours(),e.dayHeight)}var r=t(e.dayViewStart||"00:00","HH:mm"),i=t(e.dayViewEnd||"23:00","HH:mm");e.dayViewSplit=parseInt(e.dayViewSplit),e.dayHeight=60/e.dayViewSplit*30,e.days=[];for(var l=t(r),c=0;c<=i.diff(r,"hours");c++)e.days.push({label:l.format("ha")}),l.add(1,"hour");e.$watch("currentDay",n),e.$watch("events",n,!0)}]}}),angular.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"templates/main.html",restrict:"EA",scope:{events:"=calendarEvents",view:"=calendarView",currentDay:"=calendarCurrentDay",control:"=calendarControl",eventClick:"&calendarEventClick",eventEditClick:"&calendarEditEventClick",eventDeleteClick:"&calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek",eventLabel:"@calendarEventLabel",timeLabel:"@calendarTimeLabel",dayViewStart:"@calendarDayViewStart",dayViewEnd:"@calendarDayViewEnd",weekTitleLabel:"@calendarWeekTitleLabel",timespanClick:"&calendarTimespanClick",dayViewSplit:"@calendarDayViewSplit"},controller:["$scope","$timeout","$locale","$filter","moment",function(e,t,a,n,r){var i=this,l=e.weekTitleLabel||"Week {week} of {year}";this.titleFunctions={day:function(e){return n("date")(e,"EEEE d MMMM, yyyy")},week:function(e){return l.replace("{week}",r(e).week()).replace("{year}",r(e).format("YYYY"))},month:function(e){return n("date")(e,"MMMM yyyy")},year:function(e){return r(e).format("YYYY")}},this.changeView=function(t,a){e.view=t,e.currentDay=a},e.control=e.control||{},e.control.prev=function(){e.currentDay=r(e.currentDay).subtract(1,e.view).toDate()},e.control.next=function(){e.currentDay=r(e.currentDay).add(1,e.view).toDate()},e.control.getTitle=function(){return i.titleFunctions[e.view]?i.titleFunctions[e.view](e.currentDay):""};var c=!0,d=e.$watch(function(){return r.locale()+a.id},function(){if(c)return void(c=!1);var a=angular.copy(e.view);e.view="redraw",t(function(){e.view=a})}),o=e.$on("$destroy",function(){o(),d()})}]}});
//# sourceMappingURL=angular-bootstrap-calendar.min.js.map